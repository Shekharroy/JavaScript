<!DOCTYPE html>
<html lang="en">

<head>
	<meta name="robots" content="noindex,nofollow" />
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	<meta content="width=device-width, initial-scale=1.0, minimum-scale=.5, maximum-scale=1.0, user-scalable=yes" name="viewport" />
	<meta http-equiv="X-UA-Compatible" content="IE=10" />
	<meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate" />
	<META HTTP-EQUIV="EXPIRES" CONTENT="Mon, 22 Jul 2002 11:12:01 GMT">
	<meta http-equiv="pragma" content="no-cache" />
	<link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.png?v=1.840">
	<title>Adobe Viewer</title>
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css?v=1.840">
	<link rel="stylesheet" type="text/css" href="assets/css/font-awesome.min.css?v=1.840">
	<link rel="stylesheet" type="text/css" href="assets/css/dataTables.bootstrap4.min.css?v=1.840">
	<link rel="stylesheet" type="text/css" href="assets/css/select2.min.css?v=1.840">
	<link rel="stylesheet" type="text/css" href="assets/css/bootstrap-datetimepicker.min.css?v=1.840">
	<link rel="stylesheet" type="text/css" href="assets/css/style.css?v=1.840">
	<link rel="stylesheet" type="text/css" href="assets/css/custom.css?v=1.813">
	<link rel="stylesheet" type="text/css" href="assets/css/top-alertjs.css?v=1.840">
	<link rel="stylesheet" type="text/css" href="assets/plugins/summernote/dist/summernote-bs4.css?v=1.840">
	<script type="text/javascript" src="assets/css/tree/tree.css?v=1.840"></script>
	<link rel="stylesheet" type="text/css" href="assets/css/adm/adm.css?v=1.840">
	<link rel="stylesheet" type="text/css" href="assets/css/intlTelInput.css"/>

	<style>
	.cont_error {
		position: absolute;
	  	width: 100%;
	  	height: 300px;
	  	top: 50%;
	  	margin-top:-150px;
	}
	.cont_error > p  {
		font-family: 'Lato', sans-serif;
		font-weight: 300;
		font-size:24px;
		letter-spacing: 5px;
		color:#9294AE;
		position: relative;
		left:100%;
		transition: all 0.5s;
		transition-delay: 0.5s;
		-webkit-transition: all 0.5s;
		-webkit-transition-delay: 0.5s;
	}
	</style>

	<script type="text/javascript">
	document.onkeydown = function (e) {
	    e = e || window.event;//Get event
		var code = e.which || e.keyCode;//Get key code
	    if (e.ctrlKey) {
	    	if(code == 80){
	    		e.preventDefault();
	            e.stopPropagation();
			}
	    }
	};

	function loadpage(){
		try{
			var urlk = window.location.href.split("?");
			if(urlk.length > 1 && urlk[1].indexOf("a=view") == 0){
				var arr = urlk[1].split("&");
				if(arr.length == 5){
					if(arr[1].replace("b=", "") == "file"){
						//admcurrentfoldertype = arr[2].replace("c=", "");
						var docid = arr[3].replace("d=", "");
						var corpid = arr[4].replace("e=", "");
						if(corpid == localStorage._zw){
							admSingleDocumentFetchOnly(docid,corpid);
						} else {
							//admShowconfirmmsg(adm_messages.filenotpresentcorporate, confirm_Error, 5000, "", false, false);
							showerror(adm_messages.filenotpresentcorporate);
						}

					}
				}
			}
		}catch(error){
		}
	}

	var cloudApiUrlACMS = "";
	var cloudURLACT = "";
	function admSingleDocumentFetchOnly(docIds,corpid){
		ajaxindicatorstart('processing request.. please wait..');
		var cloudURLACTDomain = window.location.href;
		var cloudURLProtocol = cloudURLACTDomain.substring(0, cloudURLACTDomain.indexOf(":"))+"://";
		cloudURLACTDomain = cloudURLACTDomain.replace(cloudURLProtocol, "");
		cloudURLACTDomain = cloudURLACTDomain.substring(0, cloudURLACTDomain.indexOf("/"));
		cloudURLACT = cloudURLProtocol + cloudURLACTDomain;
		cloudApiUrlACMS = cloudURLProtocol + cloudURLACTDomain + "/api.acms";

		var type = "GET";
		var posturl = cloudApiUrlACMS + "/v1/app/unindexdoclist/0/<DOCID>/<CPID>/<ACTION>";
		posturl = posturl.replace("<ACTION>", "admSingleDocumentFetchOnlyAfter");
		posturl = posturl.replace("<DOCID>", docIds);
		posturl = posturl.replace("<CPID>", corpid);
		var extraparamjson = {"corpid":corpid};
		invokeAdapterCall(type,posturl,"","",extraparamjson);
	}

	function admSingleDocumentFetchOnlyAfter(response){
		ajaxindicatorstop();
		if(response.error == false && response.messageCode == 200){
			var docList = response.object;
			try{
				if(docList != null && docList.length > 0){
					var data = docList[0];
					if(checkViewerExtention(data.fileType, data.fileSize)) {
						try {
							//adm_viewer_locked = isLocked;
							if(data.status != "D"){
								var filesize = data.fileSize;
								if(filesize > 314572800){
									//admShowconfirmmsg(adm_messages.viewermorethan300MB, confirm_Error, 5000, "", false, false);
									showerror(adm_messages.viewermorethan300MB);
								} else {
									var fileType = data.fileType;
									fileType = fileType.toLowerCase();
									var versionNumber = data.versionNumber;
									var filenm = data.fileName;
									var docid = data.id;
									if(filenm.indexOf(".") > 0){
										var viewtype = "ADOBE_VIEWER";
										if(fileType != "doc" && fileType != "docx" && fileType != "docm" && fileType != "ppt" && fileType != "pptx" && fileType != "pptm" && fileType != "pdf"
											&& fileType != "jpeg" && fileType != "jpg" && fileType != "png" && fileType != "tif" && fileType != "tiff" && fileType != "gif"&& fileType != "txt"
											&& fileType != "xml" && fileType != "js" && fileType != "eml" && fileType != "msg" && fileType != "rtf"){
											viewtype = "NORMAL_VIEWER";
										}
										admDisplayDocViewer(data.id, viewtype);
									} else {
										//admShowconfirmmsg(adm_messages.couldnotopenFile, confirm_Error, 5000, "", false, false);
										showerror(adm_messages.couldnotopenFile);
									}
								}
							} else {
								//admShowconfirmmsg(adm_messages.admdocumentintrash, confirm_Error, 5000, "", false, false);
								showerror(adm_messages.admdocumentintrash);
							}
						} catch(error){
						}
					} else {
						var folderPath=data.folderPath;
						showerror(adm_messages.couldnotopenexternallinkfile.replace("<&FOLDERPATH;>", folderPath));
					}
				} else {
					//admShowconfirmmsg(adm_messages.filenotpresentorpermissionnotthere, confirm_Error, 5000, "", false, false);
					showerror(adm_messages.filenotpresentorpermissionnotthere);
				}
			}catch(error){}
		} else if((response.error+"") == "true" && response.messageCode == 430) {
			//admShowconfirmmsg(adm_messages.filenotpresentcorporate, confirm_Error, 5000, "", false, false);
			showerror(adm_messages.filenotpresentcorporate);
		} else {
			//admShowconfirmmsg(adm_messages.filenotpresentorpermissionnotthere, confirm_Error, 5000, "", false, false);
			showerror(adm_messages.filenotpresentorpermissionnotthere);
		}
	}

	String.prototype.replaceAll = function(strReplace, strWith) {
	    var esc = strReplace.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
	    var reg = new RegExp(esc, 'ig');
	    return this.replace(reg, strWith);
	};

	/**
	 * method to call show confirm message
	 * @param txt
	 * @param type
	 * @param duration
	 * @param targetdvid
	 * @returns {Boolean}
	 */
	function admShowconfirmmsg(txt, type, duration, targetdvid, ispop, confirm)
	{
		if(ispop) showconfirmmsgpopup(txt, type, duration, targetdvid, confirm);
		else {
			if(type == "ASK"){
				showconfirmmsgmain(txt, type, duration, targetdvid, confirm);
			} else {
				$('body').topAlertjs({
					type: type,
					message: txt,
					close: true,
					duration: 10
				});
				$(".rowdropdownmenu").removeClass("show");
			}
		}
	}

	/**
	 * method to display doc viewer
	 * @param docId
	 */
	function admDisplayDocViewer(docId, viewertype){
		ajaxindicatorstart('Opening document.. please wait..');
		var type = "GET";
		var posturl = cloudApiUrlACMS+"/v1/app/unindexdocviewer/0/<DOCID>/<VIEWERTYPE>/<ACTION>";
		posturl = posturl.replace("<ACTION>", "admDisplayDocViewerAfter");
		posturl = posturl.replace("<DOCID>", docId);
		posturl = posturl.replace("<VIEWERTYPE>", viewertype);
		invokeAdapterCall(type,posturl,"","","");
	}

	/**
	 * method to display viewer
	 * @returns {Boolean}
	 */
	function admDisplayDocViewerAfter(data){
		ajaxindicatorstop();
		if(data.error == false && data.messageCode == 200){
			if(data.object != null && data.object != "null" && data.object != ""){
				var url = data.object+"";
				var actURL = url;

				var extension = "";
				if(actURL.indexOf(".") >= 0) {
					extension = actURL.substring(actURL.lastIndexOf(".")+1);
					extension = extension.toLowerCase();
				}

				hideActionPopup("versionmodal");

				if(extension.toLowerCase() == "flac" || extension.toLowerCase() == "mp4" || extension.toLowerCase() == "m4a"
					|| extension.toLowerCase() == "mp3" || extension.toLowerCase() == "ogv" || extension.toLowerCase() == "ogm"
					|| extension.toLowerCase() == "ogg" || extension.toLowerCase() == "oga" || extension.toLowerCase() == "opus"
					|| extension.toLowerCase() == "webm" || extension.toLowerCase() == "wav"){
					actURL = actURL.replace("index.html?documentId=", "Sample-Documents/");
					//window.open(actURL, "_blank");
					setIframeURL(actURL, "");
				} else {
					if(extension == "xls" || extension == "xlsx"){
						var nURL = actURL.substring(0, actURL.indexOf("#"));
						var bURL = actURL.substring(actURL.indexOf("#")+1);
						var d = new Date();
						var n = d.getTime();
						var fl = actURL.split("#")[1];
						fl = fl.replaceAll('.xlsx', '');
						fl = fl.replaceAll('.xls', '');
						try{
							var permission = admSharedFoldersPermission[admcurrentfolderid];
							var prm = permission.split("#");
							if(prm[0] == "N") {
								actURL = nURL + "?file="+bURL+"&v=3&allowprint=N&i="+fl+"&n="+n;
							} else if(prm[0] == "Y") {
								actURL = nURL + "?file="+bURL+"&v=3&allowprint=Y&i="+fl+"&n="+n;
							}
						}catch(error){
							actURL = nURL + "?file="+bURL+"&v=3&allowprint=Y&i="+fl+"&n="+n;
						}

						//var w = window.open(actURL);
						setIframeURL(actURL, "xls");
					} else if(actURL.indexOf("adobe/#viewer/") > 0){
						//var nURL = actURL.substring(0, actURL.indexOf("#"));
						//actURL = actURL + "?p=1";
						//var w = window.open(actURL);
						setIframeURL(actURL, "");
					} else {
						actURL = actURL + "&allowprint=Y";
						actURL = actURL.replace("index.html?documentId=", "index.html?v=4.14&documentId=");
						setIframeURL(actURL, "");
					}
				}
			}else{
				//admShowconfirmmsg(adm_messages.couldnotopenviewer, confirm_Error, 5000, "", false, false);
				showerror(adm_messages.couldnotopenviewer);
			}
		}else{
			if(data.message == "NOPERMISSION"){
				//admShowconfirmmsg(adm_messages.permissiondenied, confirm_Error, 5000, "", false, false);
				showerror(adm_messages.permissiondenied);
			} else {
				//admShowconfirmmsg(adm_messages.couldnotopenviewer, confirm_Error, 5000, "", false, false);
				showerror(adm_messages.couldnotopenviewer);
			}
		}
	}

	function setIframeURL(actURL, filetype){
		actURL = actURL.substring(actURL.indexOf("//")+2);
		actURL = actURL.substring(actURL.indexOf("/")+1);
		actURL = cloudURLACT + "/" + actURL;
		/*if(filetype == "xls"){
			window.location.href=actURL;
		} else {*/
			var pHeight = $(window).height();
			var pWidth = $(window).width();
			var $iframe = $("#download_iframe");
			document.getElementById("download_iframe").height = pHeight-20;
			document.getElementById("download_iframe").width = pWidth-30;
			$iframe.attr("src",actURL);
		//}
	}

	function showerror(msg){
		$("#div1").show();
		$("#download_iframe").hide();
		$("#pid").html(msg);
	}
</script>

</head>

<body ondragstart="return false;" ondrop="return false;" onload="loadpage();">
<iframe id="download_iframe" frameborder="0"></iframe>
<div id="div1" style="top: 50%;position: absolute;left: 12%;font-weight: bold;font-size: 22px;color: red; display: none;">
<p id="pid">This file type is not supported to be viewed in the system. Please download the file if allowed and view it locally.</p>
</div>

<div class="modal fad" id="divtimeout" role="dialog"></div>

</body>

<script type="text/javascript" src="assets/js/jquery.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/jquery-migrate-1.4.1.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/intlTelInput-jquery.min.js?v=1.840"></script>
<!--	<script type="text/javascript" src="assets/js/intlTelInput.min.js"></script>-->
<script type="text/javascript" src="assets/js/jquery-ui-1.12.0.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/popper.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/bootstrap.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/jquery.dataTables.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/dataTables.bootstrap4.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/jquery.slimscroll.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/select2.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/moment.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/jstz-1.0.4.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/bootstrap-datetimepicker.min.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/top-alertjs.js?v=1.840"></script>
<script type="text/javascript" src="assets/plugins/summernote/dist/summernote-bs4.min.js?v=1.840"></script>

<script type="text/javascript" src="assets/js/app.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/variables.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/adm/adm_message.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/mousedetect.js?v=1.840"></script>
<script type="text/javascript" src="assets/js/aes.js?v=1.840"></script>

</html>